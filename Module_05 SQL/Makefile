
# Variables
VENV_PATH = ~/sgoinfre/django_venv
PYTHON = python3
PIP = pip

all: clean venv install docker apps run

clean:
	bash ./src/clean_repo.sh

venv:
	$(PYTHON) -m venv $(VENV_PATH)
	@echo 'üîÑ Activating virtual environment...'
	@. $(VENV_PATH)/bin/activate && \
	if [ "$$VIRTUAL_ENV" != "" ]; then \
		echo '‚úÖ Virtual environment activated.'; \
		echo "üíª Python version: $$(which python)"; \
		echo '‚≠ê Installing requirements...'; \
	else \
		echo '‚ùå Failed to activate virtual environment.'; \
		exit 1; \
	fi

install: venv
	@. $(VENV_PATH)/bin/activate && $(PIP) install -r requirements.txt

docker:
	@echo 'üê≥ Starting Docker...'
	-docker stop $$(docker ps -q)
	-docker rm $$(docker ps -aq)
	docker-compose up --build -d
	@if docker ps | grep -q "postgres" && docker ps | grep -q "adminer" && docker ps; then \
		echo "‚úÖ Docker is running.\n"; \
	else \
		echo "‚ùå Docker failed to start.\n"; \
		exit 1; \
	fi

apps: 
	bash ./src/create_django_project.sh
	@for i in {0..10}; do \
		bash ./src/create_app_ex$$i.sh; \
	done

run:
	bash ./src/run_project.sh


.PHONY: all clean venv install docker apps run
